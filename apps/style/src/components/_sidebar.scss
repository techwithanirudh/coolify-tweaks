@use "globals" as *;

/* Targets the main desktop sidebar container. 
     Instead of fragile width/flex classes, it's identified by its fixed position on large screens 
     and the fact that it contains the main navigation (`a[title="Dashboard"]`). This is much more stable. */
div.lg\:fixed:has(nav a[title="Dashboard"]) {
  width: var(--sidebar-width);
}

nav[x-data]:has(a[title="Dashboard"]) {
  overflow-x: hidden;
  overflow-y: auto;
  width: 100%;
  border-right: 1px solid var(--border);
  background: var(--sidebar);
  // backdrop-filter: blur(var(--blur));
  scrollbar-width: thin;
  scrollbar-color: var(--accent) transparent;

  // header coolify logo
  & > div[class*="flex pt-6 pb-4 pl-2"] {
    // there are three divs in this container, pick the middle one
    & > div {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-inline: s(0.5);
    }

    & > div:first-child {
      align-items: flex-start;
    }
  }
}

nav[x-data]:has(a[title="Dashboard"]) > ul {
  padding-inline: s(2);
}

/* Targets the sidebar header containing the team switcher.
     It's robustly selected by finding the `div` that directly contains the unique Livewire team selection dropdown. */
nav[x-data] > div:has(select[wire\:model\.live="selectedTeamId"]) {
  padding-block: s(4);
}

aside::-webkit-scrollbar {
  width: 8px;
}

aside::-webkit-scrollbar-thumb {
  border-radius: var(--radius-lg);
  background: var(--accent);
}

nav > ul > li > ul > li {
  overflow: hidden;
  border-radius: var(--radius-lg);
}

.menu-item,
.sub-menu-item {
  display: flex;
  align-items: center;
  width: 100%;
  min-width: 0;
  padding: s(2.25) s(3.75);
  border-radius: var(--radius-lg);
  font-weight: 500;
  transition:
    background 0.18s,
    color 0.18s;
  gap: s(2.5);
}

.menu-item {
  color: var(--sidebar-foreground);
}

div > .menu-item,
.sub-menu-item {
  color: var(--foreground);
}

.menu-item:hover,
.menu-item-active {
  background: var(--sidebar-accent);
  color: var(--sidebar-accent-foreground);
}

div > .menu-item:hover,
div > .menu-item-active,
.sub-menu-item:hover,
.sub-menu-item-active {
  background: var(--accent);
  color: var(--accent-foreground);
}

.menu-item .icon,
.menu-item .menu-item-icon,
.sub-menu-item .icon,
.sub-menu-item .sub-menu-item-icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  stroke-width: 1.6;
  margin: 0;

  & > * {
    display: none;
  }
}

// Menu item icons - consolidated using @each loop
$menu-icons: (
  "Dashboard": "house-fill",
  "Projects": "folder-fill",
  "Servers": "hard-drives-fill",
  "Sources": "github-logo-fill",
  "Destinations": "map-pin-fill",
  "S3\\ Storages": "database-fill",
  "Shared\\ variables": "function-fill",
  "Notifications": "bell-fill",
  "Keys\\ \\& Tokens": "key-fill",
  "Tags": "tag-fill",
  "Terminal": "terminal-fill",
  "Profile": "user-circle-fill",
  "Teams": "users-fill",
  "Settings": "gear-fill",
  "Sponsor\\ us": "heart-fill",
  "Send\\ us\\ feedback\\ or\\ get\\ help!": "chat-text-fill",
  "Logout": "sign-out-fill",
);

@each $title, $icon-name in $menu-icons {
  .menu-item[title="#{$title}"] .icon,
  .menu-item[title="#{$title}"] .menu-item-icon {
    @include icon($icon-name, "fill");
  }
}

/* Mobile slide-in */
@include mq(lg) {
  aside[class*="sidebar"] {
    position: fixed;
    z-index: 60;
    transition: transform 0.25s;
    transform: translateX(calc(-1 * var(--sidebar-width)));
    inset: 0;
  }

  body.sidebar-open aside {
    transform: none;
  }

  body.sidebar-open::after {
    position: fixed;
    z-index: 50;
    background: var(--color-overlay);
    content: "";
    inset: 0;
  }
}

/* Desktop push */
@include mq(lg) {
  body:has(nav[class*="dark:border-coolgray-200"]) main {
    padding-left: var(--sidebar-width);
  }
}

.sub-menu-wrapper {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-width: var(--sidebar-width);
  width: 100%;
  gap: s(2);

  @include mq(sm) {
    width: auto;
    max-width: 100%;
    flex-shrink: 1;
  }
}
