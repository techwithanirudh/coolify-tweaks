---
title: API
description: Work on the Nitro release API
icon: Server
---

## Introduction

The API app is a Nitro server that provides backend services for Coolify Tweaks:

- **Release asset proxying:** Serves GitHub release assets (CSS bundles, source maps)
- **Health checks:** Provides endpoint status and diagnostics

If you're working on serving release artifacts, you'll be working in this app.

## File layout

<Files>
  <Folder name="apps/api" defaultOpen>
    <Folder name="src" defaultOpen>
      <Folder name="routes">
        <File name="index.ts" description="Root route handler" />
        <Folder name="health">
          <File name="index.ts" description="Health check endpoints" />
        </Folder>
        <Folder name="release">
          <Folder name="[tag]">
            <File name="index.ts" description="Release proxy" />
          </Folder>
        </Folder>
      </Folder>
      <Folder name="middleware">
        <File name="cors.ts" description="CORS configuration" />
      </Folder>
      <Folder name="utils">
        <File name="css-compiler.ts" />
        <File name="css-transformer.ts" />
        <File name="themes.ts" />
      </Folder>
      <File name="config.ts" description="App configuration" />
    </Folder>
    <File name="nitro.config.ts" description="Nitro configuration" />
    <File name="package.json" />
  </Folder>
</Files>

## Local workflow

<Steps>
  <Step>
    **Start the dev server:**

    ```bash
    pnpm --filter @repo/api dev
    ```

    The API runs on `http://localhost:8080` by default. In development, it reads CSS directly from the style app's `dist/` folder for instant feedback.

  </Step>
  <Step>
    **Edit routes** under `apps/api/src/routes/` or utility functions in `apps/api/src/utils/`.
  </Step>
</Steps>

## Concepts

### Theme injection

The API supports dynamic theme injection for `main.user.css` requests. Here's how it works:

1. **Build-time markers**: The Style app's PostCSS plugin (`theme-identifier.ts`) injects special comment markers around CSS variable definitions:

   ```css
   /* ==UI-THEME-VARS:START== */
   :root {
     --background: #fdfdfd;
     --foreground: #000;
     /* ... more variables ... */
   }
   .dark {
     --background: #1f1c23;
     /* ... more variables ... */
   }
   /* ==UI-THEME-VARS:END== */
   ```

2. **Theme request flow**: When a user requests CSS with `?theme=<theme-id>`:
   - The API fetches the base CSS from GitHub releases
   - Fetches theme data from [TweakCN](https://tweakcn.com) (shadcn registry) using the theme ID
   - Converts the theme's CSS variables to CSS using `cssVarsToCss()` (creates `:root` and `.dark` selectors)
   - Transforms the CSS using Lightning CSS for browser compatibility
   - Uses regex to find and replace the content between `UI-THEME-VARS` markers
   - Updates the `updateURL` in the userstyle metadata to preserve the theme parameter

3. **Implementation**: The theme injection logic spans multiple utility files:
   - `themes.ts`: `getThemeCss()` fetches and validates theme data from TweakCN, `processContent()` handles the find-and-replace operation
   - `css-transformer.ts`: `cssVarsToCss()` converts theme variables to CSS format
   - `css-compiler.ts`: `transformCss()` applies Lightning CSS transformations for browser compatibility

This allows users to install themed versions of the stylesheet while maintaining the same update mechanism.

## Routes

For more details about API usage, visit [/docs/api](/docs/api).

<Accordions>
  <Accordion title="Release routes">
    - `GET /release/latest/?asset=main.css` - Serves the latest CSS bundle -
    `GET /release/[tag]/[asset]` - Serves specific release assets
  </Accordion>
  <Accordion title="Health routes">
    - `GET /health` - Basic health check - Additional diagnostic endpoints as
    needed
  </Accordion>
</Accordions>

## Testing

Run these commands from the repo root:

- **Linting:**

  ```bash
  pnpm --filter @repo/api lint
  ```

- **Formatting:**

  ```bash
  pnpm --filter @repo/api format
  ```

- **Type checking:**

  ```bash
  pnpm --filter @repo/api typecheck
  ```

- **Spell checking:**
  ```bash
  pnpm --filter @repo/api check:spelling
  ```

## Deployment

### Vercel

1. Create a new Vercel project.
2. Set the root directory to `apps/api`.
3. Vercel automatically detects Nitro and configures the build output.
4. Configure any Nitro or app-specific environment variables.
5. Deploy. Once live, the API will:
   - Serve release assets from GitHub releases
   - Proxy CSS bundles generated by the Style app
   - Respond to health check requests

## Integration with other apps

- **Style app:** API serves the built CSS bundles from releases
